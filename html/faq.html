<!DOCTYPE html>
 <head>
  <meta charset="utf-8" />
  <meta name="robots" content="noindex" />
  <style type="text/css">body, h1, h2, h3, h4, h5, h6, p, blockquote, pre, hr, dl, dd, ol, ul, figure {margin: 0;padding: 0;}</style>
  <style type="text/css">
body {
 font-size: 1em;
 font-family: sans-serif;
}
input {
 padding: 10px;
 font-size: 1.2em;
 margin: 0 auto 30px auto;
 display: block;
 width: 75%;0
}
#qa {
 height: 500px;
 overflow-y: scroll;
}
.qa {
 margin-top: 20px;
 margin-bottom: 20px;
}
.question {
 display: block;
 color: #5f6f7e;
}
.question:hover {
 text-decoration: underline;
 cursor: pointer;
}
.question::before {
 content: "+";
 color: #fff;
 font-size: 1.2em;
 background-color: #5f6f7e;
 text-align: center;
 display: inline-block;
 margin: 10px;
 width: 1.4em;
 height: 1.4em;
 line-height: 1.4em;
 border-radius: 50%;
}
.question.shown::before {
 content: "-";
}
.answer {
 display: none;
 padding: 10px;
 margin-left: 1.5em;
}
.answer.shown {
 display: block;
}
  </style>
 </head>
 <body>
  <input type="text" id="question" list="questions" placeholder="Your question here" />
  <datalist id="questions">
  </datalist>
  <div id="qa">
  </div>
  <script type="text/javascript" src="/html/lib/fuse.min.js"></script>
  <script type="text/javascript">
   var qa = [
    {
     'q': 'Pourquoi aller dans les magasins est difficile pour les personnes autistes ?',
     'a': '<p>Aller dans une boutique, un magasin ou un supermarché n\'est pas facile pour les personnes autistes. Souvent les magasins sont bruyants, imprévisibles, remplis de monde et communiquer avec les venveurs ou caissiers est souvent nécessaire. Tout cela fait qu\'il est très difficile pour les personnes autistes et leur famille d\'aller dans un magasin.</p><p>Pour les personnes avec autisme, il est plus facile d\'aller dans un magasin aux heures où il y a moins de monde lorsque la sortie est préparée en avance.</p>'
    },
    {
     'q': 'Pourquoi utiliser les transports en commun est difficile pour certaines personnes autistes ?',
     'a': '<p></p>'
    },
    {
     'q': 'abc',
     'a': 'This is the <strong>second</strong> answer'
    },
   ];
   var fuse;
   var input = document.getElementById('question');   
   var datalist = document.getElementById('questions');
   var qa_list = document.getElementById('qa');
   var unfolded = [];
   function isInt(value) {
    return !isNaN(value) && 
     parseInt(Number(value)) == value && 
     !isNaN(parseInt(value, 10));
   }
   function toggle(id) {
    var qa_element = document.getElementById('q'+(id+1));
    var qa_element_question = qa_element.childNodes[0];
    var qa_element_answer = qa_element.childNodes[1];

    if(-1 == unfolded.indexOf(id)) {
     qa_element_question.setAttribute('class', 'question shown');
     qa_element_answer.setAttribute('class', 'answer shown');
     unfolded.push(id);
    } else {
     qa_element_question.setAttribute('class', 'question');
     qa_element_answer.setAttribute('class', 'answer');
     unfolded.splice(unfolded.indexOf(id), 1);
    }
   }
   function add_question(q) {
    var qa_element = document.createElement('div');
    var qa_element_question = document.createElement('span');
    var qa_element_answer = document.createElement('span');
 
    qa_element.setAttribute('id', 'q' + (q['id']+1));
    qa_element.setAttribute('class', 'qa');

    qa_element_question.innerHTML = q['q'];
    if(-1 == unfolded.indexOf(q['id'])) {
     qa_element_question.setAttribute('class', 'question');
    } else {
     qa_element_question.setAttribute('class', 'question shown');
    }
    qa_element_question.setAttribute('onClick', 'toggle('+q['id']+');');

    qa_element_answer.innerHTML = q['a'];
    if(-1 == unfolded.indexOf(q['id'])) {
     qa_element_answer.setAttribute('class', 'answer');
    } else {
     qa_element_answer.setAttribute('class', 'answer shown');
    }

    qa_element.appendChild(qa_element_question);
    qa_element.appendChild(qa_element_answer);
    qa_list.appendChild(qa_element);
   }
   function validate() {
//    console.log(input.value);
    /* erase the div */
    while (qa_list.hasChildNodes()) {
     qa_list.removeChild(qa_list.lastChild);
    }
    var current_qa;

    if ( 0 == input.value.length) {
     current_qa = qa;
    } else {
     current_qa = fuse.search(input.value);
    }
    for (var i = 0; i < current_qa.length; i++) {
     add_question(current_qa[i]);
    }
   }
   function prepare() {
    /* add an id to each question */
    for (var i = 0; i < qa.length; i++) {
     qa[i]['id'] = i;
    }
    /* open from url */
    var hash = window.location.hash.substr(1).split(',');
    for (var i = 0; i < hash.length; i++) {
     if (!isInt(hash[i])) {
      continue;
     }
     var s = parseInt(hash[i]);
     if (s < 0 || s >= qa.length) {
       continue;
     }
     if (-1 != unfolded.indexOf(s)) {
       continue;
     }
     unfolded.push(s);
    }
    if (unfolded.length == 1) {
      input.value = qa[unfolded[0]]['q'];
    }

    /* prepare fuse */
    var fuse_options = {
     shouldSort: true,
     threshold: 0.6,
     location: 0,
     distance: 100,
     maxPatternLength: 32,
     minMatchCharLength: 1,
     keys: [
      "q",
     ]
    };
    fuse = new Fuse(qa, fuse_options); 

    /* display all questions */
    for (var i = 0; i < qa.length; i++) {

     /* add them in datalist
     var option = document.createElement('option');
     option.setAttribute('value', qa[i]['q']);
     datalist.appendChild(option);

     /* display them */
     add_question(qa[i]);
    }

    /* filter in case of one question was asked */
    if (unfolded.length == 1) {
      validate();
    }

   }
   document.body.onload = function() {
    prepare();
    input.oninput = validate;
    input.onpropertychange = validate;
   }
  </script>
 </body>
</html>
